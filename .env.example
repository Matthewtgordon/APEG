# ==================================================================
# APEG ENVIRONMENT CONFIGURATION (CANONICAL TEMPLATE)
# ==================================================================
# Single source of truth for all environments (DEMO, INTEGRATION, LIVE)
# Copy this file to .env (or .env.integration, .env.production) and fill values

# ==================================================================
# APEG API CONFIGURATION
# ==================================================================
# User-defined secret for API authentication (X-APEG-API-KEY header)
# SECURITY: Treat like a password. Do NOT reuse Shopify tokens.
# Generate: openssl rand -hex 32
# APEG_API_KEY is required for API requests (X-APEG-API-KEY header)
APEG_API_KEY=your-secret-api-key-here

# ==================================================================
# APEG RUNTIME SAFETY GATES
# ==================================================================
APEG_ENV=DEMO
APEG_ALLOW_WRITES=NO

# ==================================================================
# SHOPIFY CONFIGURATION
# ==================================================================
SHOPIFY_STORE_DOMAIN=your-store.myshopify.com
SHOPIFY_ADMIN_ACCESS_TOKEN=shpat_your_token_here
SHOPIFY_API_VERSION=2024-10

# Shopify app/webhooks (optional; required for OAuth or webhook verification)
# SHOPIFY_WEBHOOK_SHARED_SECRET=
# SHOPIFY_APP_CLIENT_ID=
# SHOPIFY_APP_CLIENT_SECRET=
# SHOPIFY_LOCATION_ID=
# SHOPIFY_BULK_LOCK_NAMESPACE=apeg

# ==================================================================
# REDIS CONFIGURATION
# ==================================================================
REDIS_URL=redis://localhost:6379

# ==================================================================
# INTEGRATION TESTING (DEMO ONLY)
# ==================================================================
# Uncomment and fill when running integration tests

# Allowlist for demo stores (comma-separated, must include SHOPIFY_STORE_DOMAIN)
# DEMO_STORE_DOMAIN_ALLOWLIST=your-demo-store.myshopify.com

# Optional: Use existing product instead of create/delete
# TEST_PRODUCT_ID=gid://shopify/Product/1234567890

# Optional: Custom tag prefix for test isolation
# TEST_TAG_PREFIX=apeg_test_

# ==================================================================
# NETWORK CONFIGURATION (OPTIONAL)
# ==================================================================
# For production deployments with reverse proxy or container orchestration

# Server bind address (0.0.0.0 allows external connections)
# APEG_API_HOST=0.0.0.0

# Server port
# APEG_API_PORT=8000

# Full base URL (for documentation and external caller reference)
# Example: http://192.168.1.50:8000 or http://100.x.x.x:8000 (Tailscale)
# APEG_API_BASE_URL=http://localhost:8000

# ==================================================================
# N8N CONFIGURATION (OPTIONAL)
# ==================================================================
# Base URL for n8n instance
# N8N_BASE_URL=

# Webhook URLs (comma-separated or JSON)
# N8N_WEBHOOK_URLS=

# Credential IDs (from n8n UI)
# N8N_CREDENTIAL_ID_SHOPIFY=
# N8N_CREDENTIAL_ID_META=

# API key if using n8n REST API
# N8N_API_KEY=

# ==================================================================
# PHASE 4: METRICS COLLECTION
# ==================================================================
# SQLite database for metrics storage
METRICS_DB_PATH=data/metrics.db

# Raw JSONL audit log directory
METRICS_RAW_DIR=data/metrics/raw

# Timezone for "yesterday" calculation (Meta ad account timezone preferred)
# Fallback if Meta timezone unavailable via API
METRICS_TIMEZONE=America/New_York

# Meta Marketing API (REQUIRED)
# Pin Graph API version (e.g., v19.0)
META_GRAPH_API_VERSION=v19.0

# Long-lived access token: https://developers.facebook.com/docs/marketing-api/overview/authentication
META_ACCESS_TOKEN=your-meta-access-token-here
META_AD_ACCOUNT_ID=act_123456789  # Include 'act_' prefix

# Meta app credentials (optional; required for token debug)
# META_APP_ID=
# META_APP_SECRET=

# Meta business assets (optional; required for ads)
# META_BUSINESS_ID=
# META_PIXEL_ID=
# META_PAGE_ID=
# META_IG_ACCOUNT_ID=

# Strategy Tag Catalog (REQUIRED)
# Path to JSON file mapping utm_campaign -> strategy_tags
STRATEGY_TAG_CATALOG=data/metrics/strategy_tags.json

# Collector Scheduling
# Daily collection runs at this local time (HH:MM format)
METRICS_COLLECTION_TIME=04:15

# Backfill gap detection (days to check on startup)
METRICS_BACKFILL_DAYS=3

# ==================================================================
# PHASE 5: FEEDBACK LOOP & REFINEMENT ENGINE
# ==================================================================
# Enable/disable feedback loop
FEEDBACK_ENABLED=false

# Analysis window configuration
FEEDBACK_WINDOW_DAYS=7
FEEDBACK_BASELINE_DAYS=7

# Minimum data thresholds
FEEDBACK_MIN_SPEND_USD=20.00
FEEDBACK_MIN_IMPRESSIONS=1000
FEEDBACK_MIN_CLICKS_PROXY=30
FEEDBACK_MIN_ORDERS=3

# Diagnosis thresholds
FEEDBACK_ROAS_BAD=2.0
FEEDBACK_ROAS_GOOD=3.0
FEEDBACK_CTR_BAD=0.01
FEEDBACK_CTR_GOOD=0.015

# Safety limits
FEEDBACK_MAX_ACTIONS_PER_RUN=5

# Approval workflow
FEEDBACK_REQUIRE_APPROVAL=true
FEEDBACK_APPROVAL_MODE=manual  # manual | n8n | none

# Decision logging
FEEDBACK_DECISION_LOG_DIR=data/feedback/raw

# Seed/test helpers (optional)
FEEDBACK_ALLOW_DUMMY_PRODUCTS=false
FEEDBACK_USE_STUB_LLM=false

# LLM API for Challenger generation
# Use Claude API (same as APEG operations)
# (Uses existing ANTHROPIC_API_KEY if set, or specify separate key)
# FEEDBACK_LLM_API_KEY=

# Optional LLM config
# FEEDBACK_LLM_MAX_TOKENS=800

# ==================================================================
# LLM PROVIDERS (OPTIONAL)
# ==================================================================
# Provide provider keys as needed. Feedback loop uses FEEDBACK_LLM_API_KEY or ANTHROPIC_API_KEY.
# OPENAI_API_KEY=
# ANTHROPIC_API_KEY=
# ANTHROPIC_MODEL=claude-3-5-sonnet-20240620
# GEMINI_API_KEY=

# ==================================================================
# INFRASTRUCTURE / LOGGING (OPTIONAL)
# ==================================================================
# DATABASE_URL=
# LOG_LEVEL=INFO
# ENVIRONMENT=DEMO  # Legacy alias for APEG_ENV
